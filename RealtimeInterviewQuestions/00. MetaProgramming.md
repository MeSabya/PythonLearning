## Build a simple ORM that maps class attributes to database fields using meta-programming techniques.

Let's build a very simple ORM (Object Relational Mapper) using meta-programming in Python â€” specifically using metaclasses. This ORM will:

- Map Python classes to tables
- Map class attributes to table columns
- Generate basic SQL for CREATE TABLE, INSERT, and SELECT

<details>

```go
# orm/fields.py
class Field:
    def __init__(self, column_type):
        self.column_type = column_type

class StringField(Field):
    def __init__(self, max_length=255):
        super().__init__(f"VARCHAR({max_length})")

class IntegerField(Field):
    def __init__(self):
        super().__init__("INTEGER")

# orm/metabase.py
class ModelMeta(type):
    def __new__(mcs, name, bases, attrs):
        print("__new__ is called on model meta", name, attrs)
        if name == 'BaseModel':
            return super().__new__(mcs, name, bases, attrs)

        mappings = {}
        for key, value in attrs.items():
            if isinstance(value, Field):
                mappings[key] = value

        cls = super().__new__(mcs, name, bases, attrs)
        cls.__mappings__ = mappings
        cls.__table__ = name.lower()
        return cls
        
# orm/base.py
class BaseModel(metaclass=ModelMeta):
    def __init__(self, **kwargs):
        print("Base Model init is called ...")
        for key in self.__mappings__:
            setattr(self, key, kwargs.get(key))

    def save(self):
        fields = []
        values = []
        for key, field in self.__mappings__.items():
            fields.append(key)
            values.append(repr(getattr(self, key)))
        sql = f"INSERT INTO {self.__table__} ({', '.join(fields)}) VALUES ({', '.join(values)});"
        print("SQL:", sql)

    @classmethod
    def create_table(cls):
        columns = [f"{name} {field.column_type}" for name, field in cls.__mappings__.items()]
        sql = f"CREATE TABLE {cls.__table__} ({', '.join(columns)});"
        print("SQL:", sql)


class User(BaseModel):
    print("User is initializing")
    id = IntegerField()
    name = StringField()
    email = StringField()

print("Create table is called")
User.create_table()
u = User(id=1, name="Alice", email="alice@example.com")
u.save()
```
</details>
